<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilgi Yarƒ±≈ümasƒ± - Ana Ekran</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="host-view">
    <div class="host-container">
        <!-- Header -->
        <header class="host-header">
            <h1>üéÆ BEN Bƒ∞LMEM E≈ûƒ∞M Bƒ∞Lƒ∞R</h1>
            <div class="game-status">
                <span id="gameStatus">Oyuncular bekleniyor...</span>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Sidebar - Player List & Scores -->
            <aside class="players-sidebar">
                <h2>Oyuncular</h2>
                <div id="playersList" class="players-list">
                    <p class="waiting-message">Oyuncular bekleniyor...</p>
                </div>
                <button id="startGameBtn" class="btn btn-primary" style="display: none;">Oyunu Ba≈ülat</button>
            </aside>

            <!-- Center - Question Board -->
            <main class="question-board">
                <div id="waitingScreen" class="waiting-screen">
                    <div class="logo-container">
                        <div class="logo-circle">üéØ</div>
                        <h2>Ben Bilmem E≈üim Bilir'e Ho≈ü Geldiniz!</h2>
                        <p>Oyuncular buradan katƒ±labilir:</p>
                        <div class="join-code" id="joinUrl">Y√ºkleniyor...</div>
                        <p class="instruction">QR okutun veya mobil cihazlardan URL'yi girin</p>
                    </div>
                </div>

                <div id="turnScreen" class="turn-screen" style="display: none;">
                    <div class="turn-info">
                        <h2>Sƒ±radaki Oyuncu</h2>
                        <div class="current-player" id="currentPlayerName">Oyuncu Adƒ±</div>
                        <p class="instruction">Kategori se√ßimi bekleniyor...</p>
                    </div>
                </div>

                <div id="questionScreen" class="question-screen" style="display: none;">
                    <div class="question-header">
                        <div class="question-meta">
                            <span class="category-badge" id="questionCategory">Kategori</span>
                            <span class="difficulty-badge" id="questionDifficulty">Kolay</span>
                            <span class="points-badge" id="questionPoints">10 puan</span>
                        </div>
                        <div class="timer-container">
                            <div class="timer" id="timer">10</div>
                            <div class="timer-bar-container">
                                <div class="timer-bar" id="timerBar"></div>
                            </div>
                        </div>
                    </div>

                    <div class="question-content">
                        <h3 id="questionText">Soru metni burada g√∂r√ºnecek</h3>
                    </div>

                    <div class="options-grid" id="optionsGrid">
                        <div class="option" data-option="A">
                            <span class="option-letter">A</span>
                            <span class="option-text">Se√ßenek A</span>
                        </div>
                        <div class="option" data-option="B">
                            <span class="option-letter">B</span>
                            <span class="option-text">Se√ßenek B</span>
                        </div>
                        <div class="option" data-option="C">
                            <span class="option-letter">C</span>
                            <span class="option-text">Se√ßenek C</span>
                        </div>
                        <div class="option" data-option="D">
                            <span class="option-letter">D</span>
                            <span class="option-text">Se√ßenek D</span>
                        </div>
                    </div>
                </div>

                <div id="resultScreen" class="result-screen" style="display: none;">
                    <div class="result-content">
                        <div class="result-icon" id="resultIcon">‚úì</div>
                        <h2 id="resultMessage">Doƒüru!</h2>
                        <div class="result-details" id="resultDetails"></div>
                        <div class="correct-answer-display" id="correctAnswerDisplay"></div>
                    </div>
                </div>

                <div id="endScreen" class="end-screen" style="display: none;">
                    <div class="trophy">üèÜ</div>
                    <h2>Oyun Bitti!</h2>
                    <div class="winner-display" id="winnerDisplay"></div>
                    <div class="final-rankings" id="finalRankings"></div>
                    <button class="btn btn-primary" onclick="location.reload()">Yeni Oyun</button>
                </div>
            </main>

            <!-- Right Sidebar - Activity Feed -->
            <aside class="activity-feed">
                <h2>Aktivite Akƒ±≈üƒ±</h2>
                <div id="activityLog" class="activity-log"></div>
            </aside>
        </div>

        <!-- Notifications -->
        <div id="notification" class="notification"></div>
    </div>

    <script>
        const socket = io();
        let gameStarted = false;

        // Join as host
        socket.emit('joinAsHost');

        // Display connection URL
        const hostname = window.location.hostname;
        const port = window.location.port;
        const playerUrl = `http://${hostname}${port ? ':' + port : ''}/player`;
        document.getElementById('joinUrl').textContent = playerUrl;

        // Host connected
        socket.on('hostConnected', (data) => {
            addActivity('üéÆ Sunucu baƒülandƒ± - Oyuncular bekleniyor');
        });

        // Player list update
        socket.on('playerListUpdate', (data) => {
            updatePlayersList(data.players);
            
            if (data.totalPlayers >= 2 && !gameStarted) {
                document.getElementById('startGameBtn').style.display = 'block';
            }
        });

        // Start game button
        document.getElementById('startGameBtn').addEventListener('click', () => {
            socket.emit('startGame');
        });

        // Game started
        socket.on('gameStarted', (data) => {
            gameStarted = true;
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('turnScreen').style.display = 'flex';
            document.getElementById('gameStatus').textContent = 'Oyun Devam Ediyor';
            document.getElementById('startGameBtn').style.display = 'none';
            
            updateCurrentTurn(data.currentPlayerName);
            updatePlayersList(data.players);
            addActivity(`üéÆ Oyun Ba≈üladƒ±! ${data.currentPlayerName} sƒ±rada`);
        });

        // New turn
        socket.on('newTurn', (data) => {
            showScreen('turnScreen');
            updateCurrentTurn(data.currentPlayerName);
            updatePlayersList(data.players);
            addActivity(`üîÑ ${data.currentPlayerName} sƒ±rada`);
        });

        // Question selected
        socket.on('questionSelected', (data) => {
            showScreen('questionScreen');
            displayQuestion(data);
            const diffText = data.difficulty === 'easy' ? 'KOLAY' : data.difficulty === 'medium' ? 'ORTA' : 'ZOR';
            addActivity(`‚ùì ${data.category} - ${diffText} (${data.points}${data.doubleActive ? 'x2' : ''} puan)`);
        });

        // Timer update
        socket.on('timerUpdate', (data) => {
            updateTimer(data.timeLeft);
        });

        // Joker used
        socket.on('jokerUsed', (data) => {
            const jokerNames = {
                'Double Trouble': '√áift Bela',
                'Extra Time': 'Ekstra S√ºre',
                'Point Theft': 'Puan Hƒ±rsƒ±zlƒ±ƒüƒ±'
            };
            showNotification(`üÉè ${data.playerName} ${jokerNames[data.jokerType] || data.jokerType} kullandƒ±!`, 'info');
            addActivity(`üÉè ${data.playerName}: ${jokerNames[data.jokerType] || data.jokerType}`);
        });

        // Answer result
        socket.on('answerResult', (data) => {
            if (data.correct) {
                showNotification(`‚úì ${data.playerName} doƒüru cevap verdi! +${data.points} puan`, 'success');
                addActivity(`‚úì ${data.playerName} +${data.points} puan (${data.newScore} toplam)`);
            } else {
                showNotification(`‚úó ${data.playerName} yanlƒ±≈ü cevap verdi${data.strikes ? ` (Uyarƒ± ${data.strikes}/3)` : ''}`, 'error');
                addActivity(`‚úó ${data.playerName} yanlƒ±≈ü${data.strikes ? ` (Uyarƒ± ${data.strikes}/3)` : ''}`);
            }
            updatePlayersList();
        });

        // Strike penalty
        socket.on('strikePenalty', (data) => {
            showNotification(`‚ö†Ô∏è ${data.playerName} 3 uyarƒ± aldƒ±! -${data.penalty} puan cezasƒ±`, 'warning');
            addActivity(`‚ö†Ô∏è ${data.playerName} CEZA -${data.penalty} puan`);
        });

        // Point theft
        socket.on('pointTheftUsed', (data) => {
            showNotification(`üé≠ ${data.thiefName}, ${data.victimName}'den ${data.stolenPoints} puan √ßaldƒ±!`, 'special');
            addActivity(`üé≠ Puan Hƒ±rsƒ±zlƒ±ƒüƒ±! ${data.thiefName}, ${data.victimName}'den ${data.stolenPoints} puan √ßaldƒ±`);
        });

        // Buzz winner
        socket.on('buzzWinner', (data) => {
            showNotification(`üîî ${data.playerName} ilk basan oldu!`, 'info');
            addActivity(`üîî ${data.playerName} bastƒ±!`);
        });

        // Show correct answer
        socket.on('showCorrectAnswer', (data) => {
            highlightCorrectAnswer(data.correctAnswer);
            setTimeout(() => {
                showScreen('resultScreen');
                displayResult(data);
            }, 1500);
        });

        // Game ended
        socket.on('gameEnded', (data) => {
            showScreen('endScreen');
            displayWinner(data);
            addActivity(`üèÜ ${data.winner.name} KAZANDI ${data.winner.score} puanla!`);
        });

        // Error handling
        socket.on('error', (data) => {
            showNotification(data.message, 'error');
        });

        // Player disconnected
        socket.on('playerDisconnected', (data) => {
            showNotification(data.message, 'warning');
            addActivity(`üëã ${data.message}`);
        });

        // Helper Functions
        function updatePlayersList(players) {
            const list = document.getElementById('playersList');
            if (!players || players.length === 0) {
                list.innerHTML = '<p class="waiting-message">Oyuncular bekleniyor...</p>';
                return;
            }

            list.innerHTML = players.map(player => `
                <div class="player-card ${player.isActive ? 'active' : ''}">
                    <div class="player-header">
                        <span class="player-name">${player.name}</span>
                        ${player.isActive ? '<span class="active-indicator">üéØ</span>' : ''}
                    </div>
                    <div class="player-score">${player.score} puan</div>
                    <div class="player-stats">
                        <span class="stat">S: ${player.questionsAsMainPlayer}/14</span>
                        ${player.strikes > 0 ? `<span class="strike-indicator">‚ö†Ô∏è ${player.strikes}</span>` : ''}
                    </div>
                    <div class="player-jokers">
                        <span class="joker ${player.jokers.double ? 'active' : 'used'}" title="√áift Bela">√ó2</span>
                        <span class="joker ${player.jokers.extraTime ? 'active' : 'used'}" title="Ekstra S√ºre">‚è±Ô∏è</span>
                        <span class="joker ${player.jokers.pointTheft ? 'active' : 'used'}" title="Puan Hƒ±rsƒ±zlƒ±ƒüƒ±">üé≠</span>
                    </div>
                </div>
            `).join('');
        }

        function updateCurrentTurn(playerName) {
            document.getElementById('currentPlayerName').textContent = playerName;
        }

        function displayQuestion(data) {
            document.getElementById('questionCategory').textContent = data.category;
            const diffText = data.difficulty === 'easy' ? 'KOLAY' : data.difficulty === 'medium' ? 'ORTA' : 'ZOR';
            document.getElementById('questionDifficulty').textContent = diffText;
            document.getElementById('questionDifficulty').className = `difficulty-badge ${data.difficulty}`;
            document.getElementById('questionPoints').textContent = `${data.points}${data.doubleActive ? ' x2' : ''} puan`;
            document.getElementById('questionText').textContent = data.question.text;

            const optionsGrid = document.getElementById('optionsGrid');
            const options = optionsGrid.querySelectorAll('.option');
            options.forEach((option, index) => {
                const letter = String.fromCharCode(65 + index);
                option.querySelector('.option-text').textContent = data.question.options[letter];
                option.className = 'option';
            });
        }

        function updateTimer(timeLeft) {
            const timerEl = document.getElementById('timer');
            const timerBar = document.getElementById('timerBar');
            
            timerEl.textContent = timeLeft;
            
            // Animate timer bar
            const questionScreen = document.getElementById('questionScreen');
            if (questionScreen.style.display !== 'none') {
                const totalTime = parseInt(timerEl.dataset.totalTime) || 20;
                const percentage = (timeLeft / totalTime) * 100;
                timerBar.style.width = percentage + '%';
                
                if (timeLeft <= 5) {
                    timerEl.classList.add('warning');
                } else {
                    timerEl.classList.remove('warning');
                }
            }
        }

        function highlightCorrectAnswer(correctAnswer) {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                if (option.dataset.option === correctAnswer) {
                    option.classList.add('correct');
                }
            });
        }

        function displayResult(data) {
            document.getElementById('correctAnswerDisplay').innerHTML = `
                <p class="correct-label">Doƒüru Cevap: <strong>${data.correctAnswer}</strong></p>
                ${data.explanation ? `<p class="explanation">${data.explanation}</p>` : ''}
            `;
        }

        function displayWinner(data) {
            document.getElementById('winnerDisplay').innerHTML = `
                <h3>${data.winner.name}</h3>
                <p class="winner-score">${data.winner.score} puan</p>
            `;

            const rankings = data.finalScores.sort((a, b) => b.score - a.score);
            document.getElementById('finalRankings').innerHTML = `
                <h3>Final Sƒ±ralamasƒ±</h3>
                ${rankings.map((player, index) => `
                    <div class="ranking-item">
                        <span class="rank">${index + 1}</span>
                        <span class="player-name">${player.name}</span>
                        <span class="score">${player.score} puan</span>
                    </div>
                `).join('')}
            `;
        }

        function showScreen(screenId) {
            ['waitingScreen', 'turnScreen', 'questionScreen', 'resultScreen', 'endScreen'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'flex';
        }

        function addActivity(message) {
            const log = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString('tr-TR');
            const entry = document.createElement('div');
            entry.className = 'activity-entry';
            entry.innerHTML = `<span class="timestamp">${timestamp}</span> ${message}`;
            log.insertBefore(entry, log.firstChild);

            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
    </script>
</body>
</html>
